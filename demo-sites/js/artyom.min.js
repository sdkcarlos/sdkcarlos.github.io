/**
 * Artyom uses webkitSpeechRecognition && SpeechSynthesisUtterance property of Google Inc.
 * Requires browser with WebKit -  This object is only supported by Google Chrome and Apple Safari.
 * 
 * @version 0.6
 * @copyright 2015, Deutschland.
 * @author Carlos Delgado | 2015
 * @param {type} window
 * @see http://sdkcarlos.github.io/artyom.html
 * @returns {object}
 */
!function(e){"use strict";function o(){var o={},p=[];o.device=m,"undefined"!=typeof artyCommands&&console.warn("The old-way of add commands (artyCommands) in artyom is obsolete and affects artyom performance,use artyom.addCommands instead [The commands structure is the same]. This warning will be removed in the next version"),o.getVoices=function(){return e.speechSynthesis.getVoices()},o.getAvailableCommands=function(){for(var e=[],o=0;o<p.length;o++){var n=p[o],t={};t.indexes=n.indexes,n.smart&&(t.smart=!0),n.description&&(t.description=n.description),e.push(t)}return e},o.initialize=function(n){if("object"!=typeof n)return void console.error("You must give the configuration for start artyom properly.");if("speechSynthesis"in e){if(n.lang){switch(n.lang){case"de":case"de-DE":g=i;break;case"en-GB":g=d;break;case"es":case"es-CO":case"es-ES":g=a;break;case"en":case"en-US":g=l;break;case"fr":case"fr-FR":g=s;break;case"it":case"it-IT":g=c;break;case"jp":case"ja-JP":g=u;break;default:console.info("The given language for artyom is not supported yet. English has been set to default")}t.lang=n.lang}return n.continuous?(t.continuous=!0,r.restartRecognition=!0):(t.continuous=!1,r.restartRecognition=!1),o.is.number(n.speed)&&(t.speed=n.speed),o.is.number(n.volume)&&(t.volume=n.volume),t.listen=n.listen,t.debug=n.debug,n.mode&&(t.mode=n.mode),t.listen===!0&&h(),!0}return f("error",{code:"artyom_unsupported",message:"Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"}),console.error("Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"),!1},o.fatality=function(){return r.restartRecognition=!1,n.stop(),!0},o.addCommands=function(e){var o=function(e){p.push(e)};if(e instanceof Array)for(var n=0;n<e.length;n++)o(e[n]);else o(e);return!0},o.emptyCommands=function(){return p=[]},o.shutUp=function(){do e.speechSynthesis.cancel();while(e.speechSynthesis.pending===!0)},o.getProperties=function(){return t};var f=function(e,o){var n=new CustomEvent(e,{detail:o});return document.dispatchEvent(n),n};o.when=function(e,o){document.addEventListener(e,function(e){o(e.detail)},!1)},o.getLanguage=function(e){if(e)switch(g){case"Google UK English Male":return"en-GB";case"Google Español":return"es";case"Google Deutsch":return"de";case"Google Français":return"fr";case"Google Italiano":return"it";case"Google 日本人":return"jp";case"Google US English":return"en-US"}switch(g){case"Google UK English Male":return"en-GB";case"Google Español":return"es-CO";case"Google Deutsch":return"de-DE";case"Google Français":return"fr-FR";case"Google Italiano":return"it-IT";case"Google 日本人":return"ja-JP";case"Google US English":return"en-US"}},o.say=function(n,r){if(o.speechSupported()){var i=function(n,i,a){var s=new SpeechSynthesisUtterance;s.text=n,s.volume=t.volume,s.rate=t.speed,g&&(s.voice=speechSynthesis.getVoices().filter(function(e){return e.name==g})[0]),r&&("function"==typeof r.onEnd&&s.addEventListener("end",function(){i>=a&&r.onEnd()}),"function"==typeof r.onStart&&s.addEventListener("start",function(){1==i&&r.onStart()})),o.debug(i+" text chunks processed succesfully out of "+a),e.speechSynthesis.speak(s)};if("undefined"!=typeof n.length)if(n.length>0){var a,s=n.split(","),c=n.split(".");a=s.length>c.length?s.filter(function(e){return e}):c.filter(function(e){return e}),a.forEach(function(e,o){var n=o+1;e&&i(e,n,a.length)}),f("saySomething")}else o.debug("Artyom expects a string to say ... none given.","warn");else o.debug("Artyom expects a string to say ... "+typeof n+" given.","warn")}},o.test=function(){"webkitSpeechRecognition"in e?(alert("I can hear you ! Initialize me now."),o.initialize({lang:"en-GB",listen:!1})):alert("Artyom can't listen to you in this browser. Speech Recognition is not supported in this browser."),"speechSynthesis"in e?o.say("1,2,3,4,5,6,7,8,9,10. Well, all is in order here.",{onEnd:function(){alert("The test of speech is over.")}}):alert("Artyom can't say nothing in this browser. Speech Synthesis is not supported in this browser.")},o.speechSupported=function(){return"speechSynthesis"in e},o.recognizingSupported=function(){return"webkitSpeechRecognition"in e};var h=function(){var e,i;if(n.continuous=!0,n.interimResults=!0,n.lang=t.lang,n.onstart=function(){o.debug("Event reached : onStart"),t.recognizing=!0,i=!0},n.onerror=function(o){"network"==o.error&&f("error",{code:"network",message:"Artyom needs internet to work properly"}),"no-speech"==o.error&&t.continuous===!1&&f("info",{code:"info_no_speech",message:"Artyom didn't hear anything. It will take a break."}),"audio-capture"==o.error&&(i=!1,f("error",{code:"audio-capture",message:"There's not any audiocapture device installed on this computer."})),"not-allowed"==o.error&&(i=!1,o.timeStamp-e<100?f("error",{code:"info_blocked",message:"Artyom needs the permision of the microphone, is blocked."}):f("error",{code:"info_denied",message:"Artyom needs the permision of the microphone, is denied"}))},n.onend=function(){f("FinishRecognition",{code:"artyom_dont_listen",message:"Artyom stop listening."}),r.restartRecognition===!0&&(i===!0?(n.start(),o.debug("Artyom initialization finished. Restarting","info")):console.error("Verify the microphone and check for the table of errors in sdkcarlos.github.io/sites/artyom.html to solve your problem. If you want to give your user a message when an error appears add an artyom listener")),t.recognizing=!1},n.onresult=function(e){if(p.length){var r=e.results.length;if(f("Recognition",{code:"artyom_listen",message:"Artyom is listening to you."}),"normal"==t.mode)for(var i=e.resultIndex;r>i;++i){var a=e.results[i][0].transcript;if(e.results[i].isFinal){var s=b(a.trim());if("function"==typeof t.helpers.redirectRecognizedTextOutput&&t.helpers.redirectRecognizedTextOutput(a,!0),s!==!1&&1==t.recognizing){o.debug("<< Executing Matching Recognition in normal mode>>"),n.stop(),t.recognizing=!1,s.wildcard?s.objeto.action(s.indice,s.wildcard.item,s.wildcard.full):s.objeto.action(s.indice);break}}else"function"==typeof t.helpers.redirectRecognizedTextOutput&&t.helpers.redirectRecognizedTextOutput(a,!1),o.debug("Normal mode : "+a)}else if("quick"==t.mode)for(var i=e.resultIndex;r>i;++i){var a=e.results[i][0].transcript;if(e.results[i].isFinal){var s=b(a.trim());if("function"==typeof t.helpers.redirectRecognizedTextOutput&&t.helpers.redirectRecognizedTextOutput(a,!1),s!==!1&&1==t.recognizing){o.debug("<< Executing Matching Recognition in quick mode>>"),n.stop(),t.recognizing=!1,s.wildcard?s.objeto.action(s.indice,s.wildcard.item):s.objeto.action(s.indice);break}}else{var s=b(a.trim());if("function"==typeof t.helpers.redirectRecognizedTextOutput&&t.helpers.redirectRecognizedTextOutput(a,!0),s!==!1&&1==t.recognizing){o.debug("<< Executing Matching Recognition in quick mode>>"),n.stop(),t.recognizing=!1,s.wildcard?s.objeto.action(s.indice,s.wildcard.item):s.objeto.action(s.indice);break}}o.debug("Quick mode : "+a)}}},t.recognizing)n.stop(),o.debug("Voice recognition stopped");else try{n.start()}catch(a){console.warn("Fatal Error There's already a instance of me running in the background . It's recommendable to restart Google Chrome to fix this issue.")}};o.doInstruction=function(e){if(!e||"string"!=typeof e)return console.warn("Cannot execute a non string command"),!1;var o=b(e);return"object"!=typeof o?(console.warn("No command founded trying with "+e),!1):o.objeto?(o.objeto.smart?o.objeto.action(o.indice,o.wildcard.item,o.wildcard.full):o.objeto.action(o.indice),!0):void 0};var b=function(e){if(!e)return console.error("Internal error: Execution of empty command"),!1;o.debug(">> "+e);for(var n=0;n<p.length;n++){for(var t=p[n],r=t.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(t.smart){if(-1!=s.indexOf("*")){var c=s.split("*");if(c.length>2){console.warn("Artyom found a smart command with "+(c.length-1)+" wildcards. Artyom only support 1 wildcard for each command. Sorry");continue}var u=c[0],l=c[1];if(""==l||" "==l){if(-1!=e.indexOf(u)||-1!=e.toLowerCase().indexOf(u.toLowerCase())){var d=e.replace(u,"");d=d.toLowerCase().replace(u.toLowerCase(),""),i=parseInt(a)}}else if(!(-1==e.indexOf(u)&&-1==e.toLowerCase().indexOf(u.toLowerCase())||-1==e.indexOf(l)&&-1==e.toLowerCase().indexOf(l.toLowerCase()))){var d=e.replace(u,"").replace(l,"");d=d.toLowerCase().replace(u.toLowerCase(),"").replace(l.toLowerCase(),""),d=d.toLowerCase().replace(l.toLowerCase(),""),i=parseInt(a)}}else console.warn("Founded command marked as SMART but have no wildcard in the indexes, remove the SMART for prevent extensive memory consuming or add the wildcard *");if(i>=0){i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:t,wildcard:{item:d,full:e}}}for(var n=0;n<p.length;n++){for(var t=p[n],r=t.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(!t.smart){if(e===s){o.debug(">> MATCHED FULL EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase()===s.toLowerCase()){o.debug(">> MATCHED OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:t}}for(var n=0;n<p.length;n++){for(var t=p[n],r=t.indexes,i=-1,a=0;a<r.length;a++)if(!t.smart){var s=r[a];if(e.indexOf(s)>=0){o.debug(">> MATCHED INDEX EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase().indexOf(s.toLowerCase())>=0){o.debug(">> MATCHED INDEX OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}if(i>=0)return{indice:i,objeto:t}}return!1};return o.debug=function(e,o){if(t.debug===!0)switch(o){case"error":console.error(e);break;case"warn":console.warn(e);break;case"info":console.info(e);break;default:console.log(e)}},o.is={integer:function(e){return Number(e)===e&&0===e%1},"float":function(e){return e===Number(e)&&0!==e%1},"function":function(e){return"function"==typeof e?!0:!1},object:function(e){return"object"==typeof e?!0:!1},"boolean":function(e){return"boolean"==typeof e?!0:!1},array:function(e){return e.constructor===Array?!0:!1},number:function(e){return e===parseFloat(e)},odd:function(e){return o.is.number(e)&&1===Math.abs(e)%2},even:function(e){return o.is.number(e)&&0===e%2},jQueryObject:function(e){return e instanceof jQuery?!0:!1}},o.detectErrors=function(n){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,"file://"==e.location.origin?(console.error("Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."),{code:"artyom_error_localfile",message:"Fatal Error Detected : It seems you're running the artyom demo from a local file ! The SpeechRecognitionAPI Needs to be hosted someway (server as http or https). Artyom will NOT work here, Sorry."}):o.device.isChrome?("https:"!=e.location.protocol&&console.warn("Artyom is not running in HTTPS protocol,running in protocol : "+e.location.protocol+" that means the browser will ask the permission of microphone too often. You need a HTTPS Connection if you want artyom in continuous mode !"),navigator.getUserMedia?(navigator.getUserMedia({audio:!0},null,function(e){"function"==typeof n&&n(e)}),{}):(console.log("Artyom couldn't found more errors in this browser."),!1)):(console.error("Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "),{code:"artyom_error_browser_unsupported",message:"Fatal Error Detected: You are not running Google Chrome ! SpeechRecognitionAPI and SpeechSynthesisAPI is only available in google chrome ! "})},o.redirectRecognizedTextOutput=function(e){return"function"!=typeof e?(console.warn("Expected function to handle the recognized text ..."),!1):(t.helpers.redirectRecognizedTextOutput=e,!0)},o.sayRandom=function(e){if(e instanceof Array){var n=Math.floor(Math.random()*e.length);return o.say(e[n]),{text:e[n],index:n}}return console.error("Random quotes must be in an array !"),null},o.newDictation=function(e){if(!o.recognizingSupported())return console.error("SpeechRecognition is not supported in this browser"),!1;var n=new webkitSpeechRecognition;return n.continuous=!0,n.interimResults=!0,n.lang=t.lang,n.onresult=function(o){for(var n="",t="",r=0;r<o.results.length;++r)o.results[r]["final"]?n+=o.results[r][0].transcript:t+=o.results[r][0].transcript;e.onResult&&e.onResult(t,n)},new function(){var o=n,t=!0,r=!1;this.onError=null,this.start=function(){e.continuous===!0&&(r=!0),o.onstart=function(){"function"==typeof e.onStart&&t===!0&&e.onStart()},o.onend=function(){r===!0?(t=!1,o.start()):(t=!0,"function"==typeof e.onEnd&&e.onEnd())},o.start()},this.stop=function(){r=!1,o.stop()},"function"==typeof e.onError&&(o.onerror=e.onError)}},o.extensions=function(){return{}},o.getVersion=function(){return"0.6"},o}if("speechSynthesis"in e&&speechSynthesis.getVoices(),"webkitSpeechRecognition"in e)var n=new webkitSpeechRecognition,t={lang:"en-GB",recognizing:!1,continuous:!1,speed:1,volume:1,listen:!0,mode:"normal",debug:!1,helpers:{redirectRecognizedTextOutput:null}},r={restartRecognition:!1};var i="Google Deutsch",a="Google Español",s="Google Français",c="Google Italiano",u="Google 日本人",l="Google US English",d="Google UK English Male",g="Google UK English Male",m={isMobile:!1,isChrome:!0};(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(m.isMobile=!0),-1==navigator.userAgent.indexOf("Chrome")&&(m.isChrome=!1),"undefined"==typeof artyom?e.artyom=Object.preventExtensions(new o):console.warn("Artyom seems to be loaded twice, it will work anyway but is recommendable for increase the visualization time of your document")}(window);