/**
 * Artyom uses webkitSpeechRecognition && SpeechSynthesisUtterance property of Google Inc.
 * Requires browser with WebKit -  This object is only supported by Google Chrome and Apple Safari.
 * 
 * @version 0.5
 * @dependencies [artyomCommands.js]
 * @copyright 2015, Deutschland.
 * @author Carlos Delgado | 2015
 * @param {type} window
 * @Description Artyom JS Core - See Documentation for further information
 * @see http://sdkcarlos.github.io/artyom.html
 * @returns {object}
 */
!function(e){"use strict";function n(){if("object"!=typeof artyCommands)console.warn("Hey .. pss ! You have not loaded the artyom commands file. I can't do anything without it, only (artyom.test()), otherwise the execution of the things could get very very bad.");else var n=artyCommands.getCommands("en-GB");var u={};return u.device=c,u.getVoices=function(){return e.speechSynthesis.getVoices()},u.getAvailableCommands=function(){var e=[];n||console.warn("Cannot list commands. No command has been added");for(var t=0;t<n.length;t++){var o=n[t],r={};r.indexes=o.indexes,o.smart&&(r.smart=!0),o.description&&(r.description=o.description),e.push(r)}return e},u.initialize=function(t){if("object"!=typeof t)return void console.error("You must give the configuration for start artyom properly.");if("speechSynthesis"in e){if(t.lang){switch(t.lang){case"de":case"de-DE":s=r;break;case"en":case"en-GB":s=a;break;case"es":case"es-CO":case"es-ES":s=i;break;default:console.info("The given language for artyom is not supported yet. English has been set to default")}o.lang=t.lang}return o.continuous=t.continuous,u.is.number(t.speed)&&(o.speed=t.speed),u.is.number(t.volume)&&(o.volume=t.volume),o.listen=t.listen,o.debug=t.debug,t.mode&&(o.mode=t.mode),"undefined"!=typeof artyCommands&&(n=artyCommands.getCommands(t.lang)),o.listen===!0&&u.hey(),!0}return alert("Error en   mobil"),u.triggerEvent("error",{code:"artyom_unsupported",message:"Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"}),console.error("Artyom is not supported in this browser. Please consider in update for a WebKit browser like Google Chrome"),!1},u.fatality=function(){return o.continuous=!1,t.stop(),!0},u.shutUp=function(){do speechSynthesis.cancel();while(speechSynthesis.pending===!0)},u.getProperties=function(){return o},u.triggerEvent=function(e,n){var t=new CustomEvent(e,{detail:n});return document.dispatchEvent(t),t},u.when=function(e,n){document.addEventListener(e,function(e){n(e.detail)},!1)},u.getLanguage=function(e){if(e)switch(s){case"Google UK English Male":return"en";case"Google Español":return"es";case"Google Deutsch":return"de"}switch(s){case"Google UK English Male":return"en-GB";case"Google Español":return"es-CO";case"Google Deutsch":return"de-DE"}},u.say=c.isMobile?function(n,t){if(u.speechSupported()){var r=new SpeechSynthesisUtterance;r.text=n,r.volume=o.volume,r.lang=o.lang,r.addEventListener("end",function(){"function"==typeof t&&t()}),e.speechSynthesis.speak(r)}}:function(n,t){if(u.speechSupported()){var r=function(n,r,i){var a=new SpeechSynthesisUtterance;a.text=n,a.volume=o.volume,a.rate=o.speed,s&&(a.voice=speechSynthesis.getVoices().filter(function(e){return e.name==s})[0]),t&&("function"==typeof t.onEnd&&a.addEventListener("end",function(){r>=i&&t.onEnd()}),"function"==typeof t.onStart&&a.addEventListener("start",function(){1==r&&t.onStart()})),u.debug(r+" text chunks processed succesfully out of "+i),e.speechSynthesis.speak(a)};if("undefined"!=typeof n.length)if(n.length>0){var i,a=n.split(","),c=n.split(".");i=a.length>c.length?a.filter(function(e){return e}):c.filter(function(e){return e}),i.forEach(function(e,n){var t=n+1;e&&r(e,t,i.length)}),u.triggerEvent("saySomething")}else u.debug("Artyom expects a string to say ... none given.","warn");else u.debug("Artyom expects a string to say ... "+typeof n+" given.","warn")}},u.test=function(){"webkitSpeechRecognition"in e?(alert("I can hear you ! Initialize me now."),u.initialize({lang:"en-GB",listen:!1})):alert("Artyom can't listen to you in this browser. Speech Recognition is not supported in this browser."),"speechSynthesis"in e?u.say("1,2,3,4,5,6,7,8,9,10. Well, all is in order here.",function(){alert("The test of speech is over.")}):alert("Artyom can't say nothing in this browser. Speech Synthesis is not supported in this browser.")},u.speechSupported=function(){return"speechSynthesis"in e},u.recognizingSupported=function(){return"webkitSpeechRecognition"in e},u.hey=function(e){if(e)return o.recognizing=!1,void t.stop();var n,r,i;if(t.continuous=!0,t.interimResults=!0,t.lang=o.lang,t.onstart=function(){u.debug("Event reached : onStart"),o.recognizing=!0,i=!0},t.onerror=function(e){"network"==e.error&&u.triggerEvent("error",{code:"network",message:"Artyom needs internet to work properly"}),"no-speech"==e.error&&(o.continuous===!1&&u.triggerEvent("info",{code:"info_no_speech",message:"Artyom didn't hear anything. It will take a break."}),n=!0),"audio-capture"==e.error&&(i=!1,u.triggerEvent("error",{code:"audio-capture",message:"There's not any audiocapture device installed on this computer."}),n=!0),"not-allowed"==e.error&&(i=!1,e.timeStamp-r<100?u.triggerEvent("error",{code:"info_blocked",message:"Artyom needs the permision of the microphone, is blocked."}):u.triggerEvent("error",{code:"info_denied",message:"Artyom needs the permision of the microphone, is denied"}),n=!0)},t.onend=function(){u.triggerEvent("FinishRecognition",{code:"artyom_dont_listen",message:"Artyom stop listening."}),o.continuous===!0&&(i===!0?(t.start(),u.debug("Artyom initialization finished. Restarting","info")):console.error("Verify the microphone and check for the table of errors in sdkcarlos.github.io/artyom.html to solve your problem. If you want to give your user a message when an error appears add an artyom listener")),o.recognizing=!1},t.onresult=function(e){var n="",r=e.results.length;if(u.triggerEvent("Recognition",{code:"artyom_listen",message:"Artyom is listening to you."}),"normal"==o.mode)for(var i=e.resultIndex;r>i;++i){var a=e.results[i][0].transcript;if(e.results[i].isFinal){var s=u.execute(a.trim());if(n+=e.results[i][0].transcript,s!==!1&&1==o.recognizing){u.debug("<< Executing Matching Recognition in normal mode>>"),t.stop(),o.recognizing=!1,s.wildcard?(console.log(s),s.objeto.action(s.indice,s.wildcard.item,s.wildcard.full)):s.objeto.action(s.indice);break}}else u.debug("Normal mode : "+a)}else if("quick"==o.mode)for(var i=e.resultIndex;r>i;++i){var a=e.results[i][0].transcript;if(e.results[i].isFinal){var s=u.execute(a.trim());if(s!==!1&&1==o.recognizing){u.debug("<< Executing Matching Recognition in quick mode>>"),t.stop(),o.recognizing=!1,s.objeto.action(s.indice);break}}else{var s=u.execute(a.trim());if(n+=e.results[i][0].transcript,s!==!1&&1==o.recognizing){u.debug("<< Executing Matching Recognition in quick mode>>"),t.stop(),o.recognizing=!1,s.wildcard?s.objeto.action(s.indice,s.wildcard.item):s.objeto.action(s.indice);break}}u.debug("Complex mode : "+a)}},o.recognizing)t.stop(),u.debug("Voice recognition stopped");else try{t.start(),n=!1}catch(a){console.warn("Fatal Error 01 :There's already a instance of me running in the background . It's recommendable to restart Google Chrome to fix this issue.")}},u.doInstruction=function(e){if(!e||"string"!=typeof e)return console.warn("Cannot execute a non string command"),!1;var n=u.execute(e);return"object"!=typeof n?(console.warn("No command founded trying with "+e),!1):n.objeto?(n.objeto.smart?n.objeto.action(n.indice,n.wildcard.item,n.wildcard.full):n.objeto.action(n.indice),!0):void 0},u.execute=function(e){if(!e)return console.log("Ejecución de comando vacío."),!1;u.debug(">> "+e);for(var t=0;t<n.length;t++){for(var o=n[t],r=o.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(o.smart){if(-1!=s.indexOf("*")){var c=s.split("*");if(c.length>2){console.warn("Artyom found a smart command with "+(c.length-1)+" wildcards. Artyom only support 1 wildcard for each command. Sorry");continue}var l=c[0],d=c[1];if(""==d||" "==d){if(-1!=e.indexOf(l)||-1!=e.toLowerCase().indexOf(l.toLowerCase())){var m=e.replace(l,"");m=m.toLowerCase().replace(l.toLowerCase(),""),i=parseInt(a)}}else if(!(-1==e.indexOf(l)&&-1==e.toLowerCase().indexOf(l.toLowerCase())||-1==e.indexOf(d)&&-1==e.toLowerCase().indexOf(d.toLowerCase()))){var m=e.replace(l,"").replace(d,"");m=m.toLowerCase().replace(l.toLowerCase(),"").replace(d.toLowerCase(),""),m=m.toLowerCase().replace(d.toLowerCase(),""),i=parseInt(a)}}else console.warn("Founded command marked as SMART but have no wildcard in the indexes, remove the SMART for prevent extensive memory consuming or add the wildcard *");if(i>=0){i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:o,wildcard:{item:m,full:e}}}for(var t=0;t<n.length;t++){for(var o=n[t],r=o.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(!o.smart){if(e===s){u.debug(">> MATCHED FULL EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase()===s.toLowerCase()){u.debug(">> MATCHED OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:o}}for(var t=0;t<n.length;t++){for(var o=n[t],r=o.indexes,i=-1,a=0;a<r.length;a++){var s=r[a];if(!o.smart){if(e.indexOf(s)>=0){u.debug(">> MATCHED INDEX EXACT OPTION "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}if(e.toLowerCase().indexOf(s.toLowerCase())>=0){u.debug(">> MATCHED INDEX OPTION CHANGING ALL TO LOWERCASE "+s+" AGAINST "+e+" WITH INDEX "+a+" IN COMMAND ","info"),i=parseInt(a);break}}}if(i>=0)return{indice:i,objeto:o}}return!1},u.fullscreen=function(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},u.debug=function(e,n){if(o.debug===!0)switch(n){case"error":console.error(e);break;case"warn":console.warn(e);case"info":console.info(e);break;default:console.log(e)}},u.is={integer:function(e){return Number(e)===e&&0===e%1},"float":function(e){return e===Number(e)&&0!==e%1},"function":function(e){return"function"==typeof e?!0:!1},object:function(e){return"object"==typeof e?!0:!1},"boolean":function(e){return"boolean"==typeof e?!0:!1},array:function(e){return e.constructor===Array?!0:!1},number:function(e){return e===parseFloat(e)},odd:function(e){return u.is.number(e)&&1===Math.abs(e)%2},even:function(e){return u.is.number(e)&&0===e%2},jQueryObject:function(e){return e instanceof jQuery?!0:!1}},u.detectErrors=function(e){return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia?navigator.getUserMedia({audio:!0},function(){e(null)},function(n){e(n)}):console.log("Artyom cant detect errors in this browser."),!1},u.sayRandom=function(e){if(e instanceof Array){var n=Math.floor(Math.random()*e.length);return u.say(e[n]),{text:e[n],index:n}}return console.error("Random quotes must be in an array !"),null},u.getVersion=function(){return"0.5"},u}if("speechSynthesis"in e&&speechSynthesis.getVoices(),"webkitSpeechRecognition"in e)var t=new webkitSpeechRecognition,o={lang:"en-GB",recognizing:!1,continuous:!1,speed:1,volume:1,listen:!0,mode:"normal",debug:!1};var r="Google Deutsch",i="Google Español",a="Google UK English Male",s="Google UK English Male",c={isMobile:!1,isChrome:!0};(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4)))&&(c.isMobile=!0),-1==navigator.userAgent.indexOf("Chrome")&&(c.isChrome=!1),"undefined"==typeof artyom&&(e.artyom=n())}(window);